<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🐶 Random Dog Describer</title>
    <style>
        /* 도트 픽셀 폰트 스타일 */
        @font-face {
            font-family: 'PixelFont';
            src: url('data:font/truetype;charset=utf-8;base64,') format('truetype');
        }
        
        /* 기본 설정 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #e3f2fd 0%, #fce4ec 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        /* 컨테이너 */
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        /* 헤더 */
        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid #333;
            position: relative;
        }
        
        /* 도트 보더 효과 */
        .header::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: repeating-linear-gradient(
                0deg,
                #333 0px,
                #333 3px,
                transparent 3px,
                transparent 6px
            ),
            repeating-linear-gradient(
                90deg,
                #333 0px,
                #333 3px,
                transparent 3px,
                transparent 6px
            );
            border-radius: 18px;
            z-index: -1;
        }
        
        .header h1 {
            font-size: 2.5em;
            color: #333;
            text-shadow: 2px 2px 0px #fff;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .header p {
            font-size: 1.2em;
            color: #666;
            font-weight: bold;
        }
        
        /* 메인 카드 */
        .main-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border: 4px solid #333;
            position: relative;
        }
        
        /* 픽셀 보더 효과 */
        .main-card::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px dotted #ffb3ba;
            border-radius: 15px;
            pointer-events: none;
        }
        
        /* 버튼 스타일 */
        .pixel-button {
            background: linear-gradient(145deg, #ffb3d1, #ff8fb3);
            border: 3px solid #333;
            color: #333;
            font-family: inherit;
            font-size: 1.2em;
            font-weight: bold;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            display: inline-block;
            text-decoration: none;
            transition: all 0.2s ease;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .pixel-button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 4px 4px 0px #333;
        }
        
        .pixel-button:active {
            transform: translate(0px, 0px);
            box-shadow: 2px 2px 0px #333;
        }
        
        .pixel-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* 강아지 이미지 컨테이너 */
        .dog-container {
            text-align: center;
            margin: 30px 0;
        }
        
        .dog-image {
            max-width: 100%;
            max-height: 400px;
            border: 4px solid #333;
            border-radius: 15px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
            background: #f5f5f5;
            padding: 10px;
        }
        
        /* 로딩 애니메이션 */
        .loading {
            display: inline-block;
            width: 200px;
            height: 200px;
            border: 4px solid #333;
            border-radius: 15px;
            background: #f0f8ff;
            position: relative;
            overflow: hidden;
        }
        
        .loading::after {
            content: '🐶';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }
        
        /* 에러 메시지 */
        .error-message {
            background: #ffebee;
            border: 3px solid #f44336;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            font-size: 1.2em;
            color: #d32f2f;
            font-weight: bold;
        }
        
        /* 묘사 섹션 */
        .description-section {
            margin-top: 30px;
        }
        
        .description-title {
            font-size: 1.5em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
            text-shadow: 1px 1px 0px #fff;
        }
        
        .description-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 3px solid #333;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1.1em;
            resize: vertical;
            background: #fafafa;
            margin-bottom: 20px;
        }
        
        .description-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px #ffb3d1;
        }
        
        /* PDF 저장 버튼 */
        .save-pdf-button {
            background: linear-gradient(145deg, #b3e5fc, #81d4fa);
            margin-left: 10px;
        }
        
        /* 최근 사진 섹션 */
        .recent-photos {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border: 3px solid #333;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .recent-photos h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            font-size: 1.3em;
        }
        
        .thumbnails-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            border: 2px solid #333;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            object-fit: cover;
            background: #f5f5f5;
        }
        
        .thumbnail:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* 반응형 디자인 */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 2em;
            }
            
            .main-card {
                padding: 20px;
            }
            
            .pixel-button {
                font-size: 1em;
                padding: 12px 20px;
            }
            
            .dog-image {
                max-height: 300px;
            }
            
            .save-pdf-button {
                margin-left: 0;
                margin-top: 10px;
            }
        }
        
        /* 숨김 클래스 */
        .hidden {
            display: none;
        }
        
        /* 버튼 컨테이너 */
        .button-container {
            text-align: center;
            margin: 20px 0;
        }
        
        /* PDF 미리보기 */
        .pdf-preview {
            background: #f9f9f9;
            border: 2px dashed #333;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- 메인 컨테이너 -->
    <div class="container">
        <!-- 헤더 -->
        <div class="header">
            <h1>🐶 Random Dog Describer</h1>
            <p>강아지 사진을 보고 영어로 묘사해보세요!</p>
        </div>
        
        <!-- 메인 카드 -->
        <div class="main-card">
            <!-- 강아지 가져오기 버튼 -->
            <div class="button-container">
                <button class="pixel-button" id="getDogBtn">
                    🎲 Show me a dog!
                </button>
            </div>
            
            <!-- 강아지 이미지 표시 영역 -->
            <div class="dog-container" id="dogContainer">
                <!-- 여기에 강아지 이미지 또는 로딩/에러 메시지가 표시됩니다 -->
            </div>
            
            <!-- 묘사 섹션 -->
            <div class="description-section" id="descriptionSection" style="display: none;">
                <div class="description-title">
                    ✏️ Describe this dog in English!
                </div>
                
                <textarea 
                    class="description-input" 
                    id="descriptionInput" 
                    placeholder="Write your description here... (예: This is a cute brown dog with long ears and a happy face.)"
                ></textarea>
                
                <div class="button-container">
                    <button class="pixel-button save-pdf-button" id="savePdfBtn">
                        💾 Save as PDF
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 최근 본 사진들 -->
        <div class="recent-photos" id="recentPhotos" style="display: none;">
            <h3>📸 Recent Dogs</h3>
            <div class="thumbnails-container" id="thumbnailsContainer">
                <!-- 썸네일들이 여기에 추가됩니다 -->
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentDogImage = '';
        let recentDogs = JSON.parse(localStorage.getItem('recentDogs')) || [];
        
        // DOM 요소 참조
        const getDogBtn = document.getElementById('getDogBtn');
        const dogContainer = document.getElementById('dogContainer');
        const descriptionSection = document.getElementById('descriptionSection');
        const descriptionInput = document.getElementById('descriptionInput');
        const savePdfBtn = document.getElementById('savePdfBtn');
        const recentPhotos = document.getElementById('recentPhotos');
        const thumbnailsContainer = document.getElementById('thumbnailsContainer');
        
        // 페이지 로드 시 실행
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🐶 Random Dog Describer 앱이 시작되었습니다!');
            updateRecentPhotos();
        });
        
        // 강아지 이미지 가져오기 버튼 이벤트
        getDogBtn.addEventListener('click', fetchRandomDog);
        
        // PDF 저장 버튼 이벤트
        savePdfBtn.addEventListener('click', saveToPDF);
        
        /**
         * 랜덤 강아지 이미지를 API에서 가져오는 함수
         */
        async function fetchRandomDog() {
            console.log('🔄 새로운 강아지 이미지를 가져오는 중...');
            
            // 버튼 비활성화 및 로딩 표시
            getDogBtn.disabled = true;
            getDogBtn.textContent = '🔄 Loading...';
            showLoading();
            
            try {
                // Dog CEO API 호출
                const response = await fetch('https://dog.ceo/api/breeds/image/random');
                const data = await response.json();
                
                if (data.status === 'success') {
                    console.log('✅ 강아지 이미지를 성공적으로 가져왔습니다:', data.message);
                    currentDogImage = data.message;
                    displayDogImage(currentDogImage);
                    showDescriptionSection();
                    addToRecentDogs(currentDogImage);
                } else {
                    throw new Error('API 응답 오류');
                }
            } catch (error) {
                console.error('❌ 강아지 이미지를 가져오는데 실패했습니다:', error);
                showError();
            } finally {
                // 버튼 다시 활성화
                getDogBtn.disabled = false;
                getDogBtn.textContent = '🎲 Show me a dog!';
            }
        }
        
        /**
         * 로딩 상태를 표시하는 함수
         */
        function showLoading() {
            dogContainer.innerHTML = '<div class="loading"></div>';
            descriptionSection.style.display = 'none';
        }
        
        /**
         * 강아지 이미지를 화면에 표시하는 함수
         * @param {string} imageUrl - 표시할 이미지 URL
         */
        function displayDogImage(imageUrl) {
            dogContainer.innerHTML = `
                <img src="${imageUrl}" alt="Random Dog" class="dog-image" 
                     onload="console.log('🖼️ 이미지 로드 완료')"
                     onerror="console.error('❌ 이미지 로드 실패'); showError();">
            `;
        }
        
        /**
         * 에러 메시지를 표시하는 함수
         */
        function showError() {
            dogContainer.innerHTML = `
                <div class="error-message">
                    사진을 불러올 수 없습니다 🐾<br>
                    <small>잠시 후 다시 시도해주세요</small>
                </div>
            `;
            descriptionSection.style.display = 'none';
        }
        
        /**
         * 묘사 섹션을 표시하는 함수
         */
        function showDescriptionSection() {
            descriptionSection.style.display = 'block';
            descriptionInput.value = ''; // 입력창 초기화
            
            // 부드러운 스크롤
            setTimeout(() => {
                descriptionSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 300);
        }
        
        /**
         * 최근 본 강아지들 배열에 새 이미지 추가
         * @param {string} imageUrl - 추가할 이미지 URL
         */
        function addToRecentDogs(imageUrl) {
            // 중복 제거
            recentDogs = recentDogs.filter(url => url !== imageUrl);
            
            // 맨 앞에 추가
            recentDogs.unshift(imageUrl);
            
            // 최대 3개까지만 유지
            if (recentDogs.length > 3) {
                recentDogs = recentDogs.slice(0, 3);
            }
            
            // 로컬 스토리지에 저장
            localStorage.setItem('recentDogs', JSON.stringify(recentDogs));
            
            // UI 업데이트
            updateRecentPhotos();
            
            console.log('📝 최근 본 강아지 목록이 업데이트되었습니다:', recentDogs.length + '개');
        }
        
        /**
         * 최근 본 사진들 UI를 업데이트하는 함수
         */
        function updateRecentPhotos() {
            if (recentDogs.length === 0) {
                recentPhotos.style.display = 'none';
                return;
            }
            
            recentPhotos.style.display = 'block';
            thumbnailsContainer.innerHTML = '';
            
            recentDogs.forEach((imageUrl, index) => {
                const thumbnail = document.createElement('img');
                thumbnail.src = imageUrl;
                thumbnail.alt = `Recent dog ${index + 1}`;
                thumbnail.className = 'thumbnail';
                thumbnail.onclick = () => {
                    console.log('🖱️ 썸네일 클릭:', imageUrl);
                    currentDogImage = imageUrl;
                    displayDogImage(imageUrl);
                    showDescriptionSection();
                    
                    // 해당 이미지를 맨 앞으로 이동
                    addToRecentDogs(imageUrl);
                };
                
                thumbnailsContainer.appendChild(thumbnail);
            });
        }
        
        /**
         * PDF로 저장하는 함수 (브라우저 인쇄 기능 활용)
         */
        function saveToPDF() {
            const description = descriptionInput.value.trim();
            
            if (!description) {
                alert('강아지에 대한 설명을 먼저 작성해주세요! ✏️');
                descriptionInput.focus();
                return;
            }
            
            console.log('💾 PDF 저장 준비 중...');
            
            // 현재 날짜 정보
            const currentDate = new Date();
            const dateStr = currentDate.toLocaleDateString('ko-KR');
            const timeStr = currentDate.toLocaleTimeString('ko-KR');
            
            // 안전한 텍스트 처리
            const safeDescription = description.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
            
            // PDF 미리보기 창 생성
            const printWindow = window.open('', '_blank');
            
            printWindow.document.write('<!DOCTYPE html>');
            printWindow.document.write('<html><head>');
            printWindow.document.write('<title>Dog Description - ' + dateStr + '</title>');
            printWindow.document.write('<style>');
            printWindow.document.write('body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; color: #333; }');
            printWindow.document.write('.header { text-align: center; border-bottom: 3px double #333; padding-bottom: 20px; margin-bottom: 30px; }');
            printWindow.document.write('.header h1 { color: #2196F3; font-size: 2.5em; margin: 0; }');
            printWindow.document.write('.header p { font-size: 1.2em; margin: 10px 0 0 0; color: #666; }');
            printWindow.document.write('.content { max-width: 800px; margin: 0 auto; }');
            printWindow.document.write('.dog-image { display: block; max-width: 100%; max-height: 400px; margin: 20px auto; border: 3px solid #333; border-radius: 10px; }');
            printWindow.document.write('.description-box { background: #f9f9f9; border: 2px solid #333; border-radius: 10px; padding: 20px; margin-top: 20px; }');
            printWindow.document.write('.description-title { font-size: 1.5em; font-weight: bold; color: #E91E63; margin-bottom: 15px; }');
            printWindow.document.write('.description-text { font-size: 1.2em; line-height: 1.8; white-space: pre-wrap; word-wrap: break-word; }');
            printWindow.document.write('.footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #eee; color: #888; font-size: 0.9em; }');
            printWindow.document.write('</style></head><body>');
            printWindow.document.write('<div class="content">');
            printWindow.document.write('<div class="header">');
            printWindow.document.write('<h1>🐶 Dog Description</h1>');
            printWindow.document.write('<p>Created with Random Dog Describer</p>');
            printWindow.document.write('</div>');
            printWindow.document.write('<img src="' + currentDogImage + '" alt="Dog Photo" class="dog-image">');
            printWindow.document.write('<div class="description-box">');
            printWindow.document.write('<div class="description-title">📝 My Description:</div>');
            printWindow.document.write('<div class="description-text">' + safeDescription + '</div>');
            printWindow.document.write('</div>');
            printWindow.document.write('<div class="footer">');
            printWindow.document.write('Created on ' + dateStr + ' ' + timeStr + '<br>🐾 Keep describing and keep learning! 🐾');
            printWindow.document.write('</div></div></body></html>');
            
            printWindow.document.close();
            
            // 이미지 로드 후 자동으로 인쇄 대화상자 열기
            setTimeout(() => {
                printWindow.print();
            }, 1000);
            
            console.log('✅ PDF 인쇄 대화상자가 열렸습니다.');
            
            // 사용자에게 안내 메시지
            setTimeout(() => {
                alert('💡 인쇄 대화상자에서 "PDF로 저장"을 선택하면\\n강아지 사진과 설명이 PDF로 저장됩니다! 📄');
            }, 1500);
        }
        
        // 키보드 단축키
        document.addEventListener('keydown', function(event) {
            // Ctrl + Enter: PDF 저장
            if (event.ctrlKey && event.key === 'Enter') {
                if (currentDogImage && descriptionInput.value.trim()) {
                    saveToPDF();
                }
            }
            
            // Space: 새로운 강아지 가져오기 (입력창에 포커스가 없을 때만)
            if (event.key === ' ' && event.target !== descriptionInput) {
                event.preventDefault();
                if (!getDogBtn.disabled) {
                    fetchRandomDog();
                }
            }
        });
        
        // 에러 핸들링 및 로그
        window.addEventListener('error', function(event) {
            console.error('🚨 앱 에러 발생:', event.error);
        });
        
        // 텍스트 입력 시 자동 저장 (로컬 스토리지)
        descriptionInput.addEventListener('input', function() {
            if (currentDogImage) {
                const data = {
                    image: currentDogImage,
                    description: this.value,
                    timestamp: Date.now()
                };
                localStorage.setItem('currentDescription', JSON.stringify(data));
            }
        });
        
        // 페이지를 떠날 때 확인 (작성 중인 내용이 있을 경우)
        window.addEventListener('beforeunload', function(event) {
            if (descriptionInput.value.trim() && currentDogImage) {
                event.preventDefault();
                return '작성 중인 설명이 있습니다. 정말 페이지를 떠나시겠습니까?';
            }
        });
        
        console.log('🎉 Random Dog Describer 앱이 준비되었습니다!');
        console.log('💡 팁: 스페이스바를 눌러 새로운 강아지를 가져올 수 있습니다!');
        console.log('💡 팁: Ctrl+Enter를 눌러 PDF로 저장할 수 있습니다!');
    </script>
</body>
</html>
